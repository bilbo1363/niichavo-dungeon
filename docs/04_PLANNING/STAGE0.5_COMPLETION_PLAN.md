# Этап 0.5: Завершение фундамента

**Дата начала:** 22.10.2025  
**Статус:** 🔄 В процессе  
**Приоритет:** ⭐⭐⭐ КРИТИЧЕСКИЙ

---

## 🎯 ЦЕЛЬ

Доделать системы Этапа 0, чтобы они **реально работали** в игре, а не только существовали в коде.

---

## ❌ ПРОБЛЕМЫ (из аудита)

### 1. Опыт НЕ даётся
- ✅ Код: `LevelSystem.gain_exp()`
- ❌ Не вызывается в игре
- ❌ Игрок не может повышать уровень

### 2. Способности НЕ применяются
- ✅ UI работает
- ❌ Эффекты не применяются
- ❌ Только картинка

### 3. Крафт НЕ работает
- ✅ Рецепты есть
- ❌ Нет UI крафта
- ❌ Нельзя крафтить

### 4. Ресурсов НЕТ
- ❌ Нет материалов
- ❌ Нет добычи
- ❌ Нечем крафтить

---

## 📋 ПЛАН РАБОТ (7-10 дней)

### НЕДЕЛЯ 1: ИНТЕГРАЦИЯ СИСТЕМ

#### День 1: Интеграция опыта (3-4 часа) ⭐⭐⭐
**Файлы:** `src/core/game.py`, `src/entities/enemy.py`

**Задачи:**
- [ ] Давать опыт за убийство врагов
  - Крыса: 10 XP
  - Призрак: 25 XP
  - Мутант: 50 XP
- [ ] Давать опыт за открытие контейнеров (5 XP)
- [ ] Давать опыт за чтение записок (15 XP)
- [ ] Давать опыт за исследование (первое посещение комнаты: 3 XP)
- [ ] Показывать уведомление о получении опыта
- [ ] Показывать уведомление о повышении уровня
- [ ] Тестирование

**Критерий успеха:**
- ✅ Игрок получает опыт за действия
- ✅ Уровень повышается при достижении порога
- ✅ Видны уведомления

---

#### День 2: Применение пассивных способностей (4-5 часов) ⭐⭐⭐
**Файлы:** `src/core/game.py`, `src/entities/player.py`

**Задачи:**
- [ ] Связать способности с модификаторами
- [ ] При разблокировке способности → добавить модификатор
- [ ] Модификаторы влияют на характеристики
- [ ] Обновить расчёт урона с учётом модификаторов
- [ ] Обновить расчёт защиты с учётом модификаторов
- [ ] Тестирование

**Пример:**
```python
# При разблокировке "Железная кожа"
ability = ability_tree.abilities["iron_skin"]
for effect in ability.effects:
    modifier = StatModifier(
        type=effect.modifier_type,
        stat=effect.stat,
        value=effect.value
    )
    modifier_manager.add_modifier(modifier, source="ability_iron_skin")
```

**Критерий успеха:**
- ✅ Разблокированные способности дают бонусы
- ✅ Бонусы видны в характеристиках
- ✅ Бонусы влияют на бой

---

#### День 3: Активные способности (4-5 часов) ⭐⭐
**Файлы:** `src/core/game.py`, `src/entities/player.py`

**Задачи:**
- [ ] Горячие клавиши для активных способностей (1-4)
- [ ] Система перезарядок
- [ ] Визуальные эффекты использования
- [ ] Звуковые эффекты (опционально)
- [ ] UI индикаторы перезарядки
- [ ] Тестирование

**Способности для реализации:**
- Рывок (Dash) - 1
- Лечение (Heal) - 2
- Щит (Shield) - 3

**Критерий успеха:**
- ✅ Можно использовать активные способности
- ✅ Перезарядки работают
- ✅ Видны эффекты

---

#### День 4-5: Система ресурсов (6-8 часов) ⭐⭐⭐
**Файлы:** `src/items/item_database.py`, `src/level/item_spawner.py`

**Задачи:**
- [ ] Добавить материалы в ItemDatabase
  - Металлолом (scrap_metal)
  - Электронные компоненты (electronics)
  - Химикаты (chemicals)
  - Ткань (cloth)
  - Дерево (wood)
  - Магические кристаллы (magic_crystal)
- [ ] Спавн материалов на этажах
- [ ] Сбор материалов (E)
- [ ] Отображение в инвентаре
- [ ] Стакование материалов
- [ ] Тестирование

**Распределение по этажам:**
```python
FLOOR_1_3: scrap_metal, cloth, wood
FLOOR_4_6: electronics, chemicals
FLOOR_7_10: magic_crystal
```

**Критерий успеха:**
- ✅ Материалы спавнятся на этажах
- ✅ Можно собирать материалы
- ✅ Материалы хранятся в инвентаре

---

### НЕДЕЛЯ 2: КРАФТ

#### День 6-7: UI крафта (6-8 часов) ⭐⭐⭐
**Файлы:** `src/ui/crafting_ui.py`

**Задачи:**
- [ ] Создать CraftingUI класс
- [ ] Список доступных рецептов
- [ ] Фильтр по станциям
- [ ] Фильтр по категориям
- [ ] Отображение требований
- [ ] Проверка ресурсов (зелёный/красный)
- [ ] Кнопка крафта
- [ ] Анимация крафта
- [ ] Получение предмета
- [ ] Интеграция с game.py (горячая клавиша B - Build)
- [ ] Тестирование

**Дизайн UI:**
```
┌─────────────────────────────────────────┐
│  🔨 КРАФТ                                │
├─────────────────────────────────────────┤
│  Станция: [Верстак ▼]                   │
│  Категория: [Оружие] [Броня] [Расходники]│
│                                          │
│  ┌──────────────────────────────────┐   │
│  │ ⚔️ Железный меч                  │   │
│  │ Требования:                      │   │
│  │ ✅ Металлолом x5                 │   │
│  │ ✅ Дерево x2                     │   │
│  │ ✅ Верстак (Tier 1)              │   │
│  │                                  │   │
│  │ [СОЗДАТЬ]                        │   │
│  └──────────────────────────────────┘   │
│                                          │
│  ┌──────────────────────────────────┐   │
│  │ 🧪 Зелье лечения                 │   │
│  │ Требования:                      │   │
│  │ ❌ Химикаты x3                   │   │
│  │ ✅ Ткань x1                      │   │
│  │ ❌ Лаборатория (Tier 1)          │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

**Критерий успеха:**
- ✅ UI открывается (B)
- ✅ Видны доступные рецепты
- ✅ Видны требования
- ✅ Можно скрафтить предмет
- ✅ Предмет добавляется в инвентарь

---

#### День 8-9: Интеграция крафта с игрой (4-6 часов) ⭐⭐
**Файлы:** `src/core/game.py`

**Задачи:**
- [ ] Горячая клавиша B - открыть крафт
- [ ] Крафт доступен только на чердаке
- [ ] Проверка доступности станций
- [ ] Расход ресурсов при крафте
- [ ] Получение опыта за крафт (10-50 XP)
- [ ] Звук крафта
- [ ] Анимация крафта
- [ ] Тестирование

**Критерий успеха:**
- ✅ Можно открыть крафт на чердаке
- ✅ Крафт расходует ресурсы
- ✅ Предметы создаются
- ✅ Даётся опыт

---

#### День 10: Финальное тестирование (4-6 часов) ⭐⭐⭐
**Задачи:**
- [ ] Полный цикл: убить врага → получить опыт → повысить уровень
- [ ] Разблокировать способность → получить бонус → проверить в бою
- [ ] Собрать ресурсы → скрафтить предмет → использовать
- [ ] Улучшить станцию → открыть новые рецепты
- [ ] Сохранить/загрузить → проверить всё работает
- [ ] Баланс опыта и ресурсов
- [ ] Исправление багов

**Критерий успеха:**
- ✅ Все системы работают вместе
- ✅ Нет критических багов
- ✅ Баланс приемлемый

---

## 📊 ПРОГРЕСС

```
День 1: Опыт              [░░░░░░░░░░] 0%
День 2: Пассивные         [░░░░░░░░░░] 0%
День 3: Активные          [░░░░░░░░░░] 0%
День 4-5: Ресурсы         [░░░░░░░░░░] 0%
День 6-7: UI крафта       [░░░░░░░░░░] 0%
День 8-9: Интеграция      [░░░░░░░░░░] 0%
День 10: Тестирование     [░░░░░░░░░░] 0%

ИТОГО: [░░░░░░░░░░] 0%
```

---

## 🎯 КРИТЕРИИ ЗАВЕРШЕНИЯ

### Функциональность
- ✅ Игрок получает опыт и повышает уровень
- ✅ Способности дают реальные бонусы
- ✅ Можно крафтить предметы
- ✅ Ресурсы спавнятся и собираются
- ✅ Всё сохраняется/загружается

### Баланс
- ✅ Опыт даётся в разумных количествах
- ✅ Уровни повышаются не слишком быстро/медленно
- ✅ Ресурсов достаточно для крафта
- ✅ Способности дают ощутимые бонусы

### UX
- ✅ Игрок понимает, как всё работает
- ✅ Прогресс виден и ощутим
- ✅ UI интуитивно понятен

---

## 📝 СЛЕДУЮЩИЕ ШАГИ

После завершения Этапа 0.5:
1. Обновить план.md
2. Создать отчёт STAGE0.5_COMPLETE.md
3. Закоммитить всё
4. Перейти к Этапу 1: Журнал исследователя

---

**Начинаем с Дня 1: Интеграция опыта! 🚀**
