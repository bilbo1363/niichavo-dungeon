# –ë–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ - –ü–æ—à–∞–≥–æ–≤—ã–µ —Å—Ä–∞–∂–µ–Ω–∏—è

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–†–µ—Ñ–µ—Ä–µ–Ω—Å:** Heroes of Might and Magic  
**–¢–∏–ø:** –ü–æ—à–∞–≥–æ–≤–∞—è —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –±–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

–ü—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ —Å –≤—Ä–∞–≥–æ–º –∏–≥—Ä–∞ **–ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è** –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω –±–æ—è —Å —Ç–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å–µ—Ç–∫–æ–π.

---

## 2. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –±–æ–π

### 2.1 –¢—Ä–∏–≥–≥–µ—Ä—ã –±–æ—è

```python
class CombatTrigger:
    """–¢—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞—á–∞–ª–∞ –±–æ—è"""
    
    @staticmethod
    def check_combat_start(player: Player, level: Level) -> Optional[Combat]:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∞–ª–∞ –±–æ—è"""
        
        # 1. –ò–≥—Ä–æ–∫ –Ω–∞—Å—Ç—É–ø–∏–ª –Ω–∞ –≤—Ä–∞–≥–∞
        enemy = level.get_enemy_at(player.x, player.y)
        if enemy:
            return Combat.start(player, [enemy])
        
        # 2. –í—Ä–∞–≥ –∑–∞–º–µ—Ç–∏–ª –∏–≥—Ä–æ–∫–∞ (AI)
        nearby_enemies = level.get_enemies_in_radius(player.x, player.y, radius=5)
        for enemy in nearby_enemies:
            if enemy.ai.can_see(player) and enemy.ai.is_aggressive():
                return Combat.start(player, [enemy])
        
        # 3. –ò–≥—Ä–æ–∫ –∞—Ç–∞–∫–æ–≤–∞–ª –≤—Ä–∞–≥–∞ (–¥–∞–ª—å–Ω–∏–π –±–æ–π)
        if player.attacked_enemy:
            return Combat.start(player, [player.attacked_enemy])
            
        return None
```

### 2.2 –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞

```
–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ ‚Üí –í—Å—Ç—Ä–µ—á–∞ —Å –≤—Ä–∞–≥–æ–º ‚Üí –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ (0.5 —Å–µ–∫)
                                          ‚Üì
                                   –ë–æ–µ–≤–æ–π —ç–∫—Ä–∞–Ω
                                   (—Ç–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å–µ—Ç–∫–∞)
```

---

## 3. –ë–æ–µ–≤–æ–µ –ø–æ–ª–µ

### 3.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –ë–û–ï–í–û–ï –ü–û–õ–ï (15x10)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                             ‚îÇ
‚îÇ  üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨ú‚¨ú‚¨úüü´üü´‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨ú‚¨ú‚¨úüü´üü´‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨úüë§‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüëπ‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨úüü¶              ‚îÇ
‚îÇ  üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶üü¶              ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  üë§ –ò–≥—Ä–æ–∫  HP: 85/100  ‚ö°: 50/100          ‚îÇ
‚îÇ  üëπ –ú—É—Ç–∞–Ω—Ç HP: 120/150                     ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –•–û–î: –ò–≥—Ä–æ–∫  [–ê—Ç–∞–∫–∞] [–ó–∞—â–∏—Ç–∞] [–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.2 –¢–∏–ø—ã –∫–ª–µ—Ç–æ–∫

```python
class BattleTile(Enum):
    """–¢–∏–ø—ã –∫–ª–µ—Ç–æ–∫ –Ω–∞ –±–æ–µ–≤–æ–º –ø–æ–ª–µ"""
    EMPTY = 0        # ‚¨ú –ü—É—Å—Ç–∞—è –∫–ª–µ—Ç–∫–∞
    WALL = 1         # üü¶ –°—Ç–µ–Ω–∞ (–Ω–µ–ø—Ä–æ—Ö–æ–¥–∏–º–æ)
    OBSTACLE = 2     # üü´ –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ (–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã—Å—Ç—Ä–µ–ª—ã)
    DIFFICULT = 3    # üü® –°–ª–æ–∂–Ω–∞—è –º–µ—Å—Ç–Ω–æ—Å—Ç—å (2 –æ—á–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è)
    HAZARD = 4       # üü• –û–ø–∞—Å–Ω–æ—Å—Ç—å (—É—Ä–æ–Ω –ø—Ä–∏ –≤—Ö–æ–¥–µ)
    COVER = 5        # üü© –£–∫—Ä—ã—Ç–∏–µ (+–∑–∞—â–∏—Ç–∞)
```

### 3.3 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–µ–≤–æ–≥–æ –ø–æ–ª—è

```python
class BattlefieldGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–æ–µ–≤—ã—Ö –ø–æ–ª–µ–π"""
    
    def generate(self, environment: str, difficulty: int) -> np.ndarray:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª—è –±–æ—è"""
        field = np.zeros((10, 15), dtype=np.uint8)
        
        # –ì—Ä–∞–Ω–∏—Ü—ã
        field[0, :] = BattleTile.WALL.value
        field[-1, :] = BattleTile.WALL.value
        field[:, 0] = BattleTile.WALL.value
        field[:, -1] = BattleTile.WALL.value
        
        # –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
        if environment == "dungeon":
            self._add_pillars(field)
        elif environment == "cave":
            self._add_rocks(field)
        elif environment == "ruins":
            self._add_debris(field)
            
        # –û–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö
        if difficulty > 5:
            self._add_hazards(field)
            
        return field
```

---

## 4. –ú–µ—Ö–∞–Ω–∏–∫–∞ –±–æ—è

### 4.1 –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞

```python
class Initiative:
    """–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã (–∫–∞–∫ –≤ HoMM)"""
    
    @staticmethod
    def calculate(unit) -> int:
        """–†–∞—Å—á–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã"""
        base = unit.stats.speed
        
        # –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
        if unit.has_buff("haste"):
            base += 3
        if unit.has_debuff("slow"):
            base -= 3
            
        # –°–ª—É—á–∞–π–Ω–æ—Å—Ç—å ¬±1
        return base + random.randint(-1, 1)
    
    @staticmethod
    def get_turn_order(units: List[Unit]) -> List[Unit]:
        """–ü–æ—Ä—è–¥–æ–∫ —Ö–æ–¥–æ–≤"""
        return sorted(units, key=lambda u: Initiative.calculate(u), reverse=True)
```

### 4.2 –•–æ–¥ —é–Ω–∏—Ç–∞

```python
class CombatTurn:
    """–•–æ–¥ –≤ –±–æ—é"""
    
    def __init__(self, unit: Unit):
        self.unit = unit
        self.movement_points = unit.stats.movement
        self.action_used = False
        
    def can_move(self) -> bool:
        """–ú–æ–∂–µ—Ç –ª–∏ –¥–≤–∏–≥–∞—Ç—å—Å—è"""
        return self.movement_points > 0
        
    def can_act(self) -> bool:
        """–ú–æ–∂–µ—Ç –ª–∏ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å"""
        return not self.action_used
        
    def move(self, target_pos: tuple[int, int]) -> bool:
        """–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ"""
        path = find_path(self.unit.position, target_pos)
        cost = len(path)
        
        if cost <= self.movement_points:
            self.unit.position = target_pos
            self.movement_points -= cost
            return True
        return False
        
    def attack(self, target: Unit) -> dict:
        """–ê—Ç–∞–∫–∞"""
        if not self.can_act():
            return {"success": False, "reason": "Already acted"}
            
        damage = self._calculate_damage(target)
        target.take_damage(damage)
        self.action_used = True
        
        return {
            "success": True,
            "damage": damage,
            "critical": damage > self.unit.stats.attack * 1.5
        }
```

### 4.3 –î–µ–π—Å—Ç–≤–∏—è –≤ –±–æ—é

#### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–î–≤–∏–∂–µ–Ω–∏–µ** (Movement Points)
   - –ö–∞–∂–¥—ã–π —é–Ω–∏—Ç –∏–º–µ–µ—Ç –æ—á–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è
   - –ü—É—Å—Ç–∞—è –∫–ª–µ—Ç–∫–∞ = 1 –û–î
   - –°–ª–æ–∂–Ω–∞—è –º–µ—Å—Ç–Ω–æ—Å—Ç—å = 2 –û–î
   - –ú–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–æ/–ø–æ—Å–ª–µ –∞—Ç–∞–∫–∏

2. **–ê—Ç–∞–∫–∞** (1 –¥–µ–π—Å—Ç–≤–∏–µ)
   - –ë–ª–∏–∂–Ω–∏–π –±–æ–π (—Å–æ—Å–µ–¥–Ω—è—è –∫–ª–µ—Ç–∫–∞)
   - –î–∞–ª—å–Ω–∏–π –±–æ–π (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–∞–ª—å–Ω–æ—Å—Ç–∏)
   - –ú–∞–≥–∏—è (–∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è)

3. **–ó–∞—â–∏—Ç–∞** (1 –¥–µ–π—Å—Ç–≤–∏–µ)
   - +50% –∫ –∑–∞—â–∏—Ç–µ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞
   - –ù–µ–ª—å–∑—è –¥–≤–∏–≥–∞—Ç—å—Å—è

4. **–û–∂–∏–¥–∞–Ω–∏–µ** (Wait)
   - –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –≤ –∫–æ–Ω–µ—Ü –æ—á–µ—Ä–µ–¥–∏

5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞** (1 –¥–µ–π—Å—Ç–≤–∏–µ)
   - –ó–µ–ª—å–µ
   - –°–≤–∏—Ç–æ–∫
   - –†—É–Ω–∞

---

## 5. –ë–æ–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### 5.1 –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—ã

```python
@dataclass
class CombatStats:
    """–ë–æ–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏"""
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ
    health: int          # –ó–¥–æ—Ä–æ–≤—å–µ
    attack: int          # –ê—Ç–∞–∫–∞
    defense: int         # –ó–∞—â–∏—Ç–∞
    
    # –î–≤–∏–∂–µ–Ω–∏–µ
    movement: int        # –û—á–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è
    speed: int          # –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
    accuracy: int = 100  # –¢–æ—á–Ω–æ—Å—Ç—å (%)
    evasion: int = 0     # –£–∫–ª–æ–Ω–µ–Ω–∏–µ (%)
    critical: int = 5    # –®–∞–Ω—Å –∫—Ä–∏—Ç–∞ (%)
    
    # –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
    resistance_physical: int = 0
    resistance_magic: int = 0
    resistance_fire: int = 0
    resistance_ice: int = 0
```

### 5.2 –†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞

```python
class DamageCalculator:
    """–†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞ (–∫–∞–∫ –≤ HoMM)"""
    
    @staticmethod
    def calculate(attacker: Unit, defender: Unit) -> int:
        """–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞"""
        
        # –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω
        base_damage = attacker.stats.attack
        
        # –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—Ç–∞–∫–∏ vs –∑–∞—â–∏—Ç—ã
        if attacker.stats.attack > defender.stats.defense:
            multiplier = 1 + (attacker.stats.attack - defender.stats.defense) * 0.05
        else:
            multiplier = 1 / (1 + (defender.stats.defense - attacker.stats.attack) * 0.05)
        
        damage = int(base_damage * multiplier)
        
        # –°–ª—É—á–∞–π–Ω–æ—Å—Ç—å ¬±20%
        variance = random.uniform(0.8, 1.2)
        damage = int(damage * variance)
        
        # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä
        if random.randint(1, 100) <= attacker.stats.critical:
            damage = int(damage * 2)
            
        # –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
        if attacker.damage_type == "physical":
            damage = int(damage * (1 - defender.stats.resistance_physical / 100))
            
        return max(1, damage)  # –ú–∏–Ω–∏–º—É–º 1 —É—Ä–æ–Ω
```

---

## 6. –¢–∏–ø—ã –≤—Ä–∞–≥–æ–≤

### 6.1 –ö–ª–∞—Å—Å—ã –≤—Ä–∞–≥–æ–≤

```python
class EnemyType(Enum):
    """–¢–∏–ø—ã –≤—Ä–∞–≥–æ–≤"""
    
    # –ë–ª–∏–∂–Ω–∏–π –±–æ–π
    MELEE_WEAK = "melee_weak"      # –ö—Ä—ã—Å–∞, —Å–ª–∏–∑—å
    MELEE_NORMAL = "melee_normal"  # –ì–æ–±–ª–∏–Ω, —Å–∫–µ–ª–µ—Ç
    MELEE_STRONG = "melee_strong"  # –û—Ä–∫, –≥–æ–ª–µ–º
    
    # –î–∞–ª—å–Ω–∏–π –±–æ–π
    RANGED = "ranged"              # –õ—É—á–Ω–∏–∫, —Å—Ç—Ä–µ–ª–æ–∫
    
    # –ú–∞–≥–∏—è
    MAGE = "mage"                  # –ú–∞–≥, –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç
    
    # –û—Å–æ–±—ã–µ
    BOSS = "boss"                  # –ë–æ—Å—Å—ã
    ELITE = "elite"                # –≠–ª–∏—Ç–Ω—ã–µ –≤—Ä–∞–≥–∏
```

### 6.2 –ü—Ä–∏–º–µ—Ä—ã –≤—Ä–∞–≥–æ–≤

#### –ö—Ä—ã—Å–∞ (–°–ª–∞–±—ã–π –±–ª–∏–∂–Ω–∏–π)
```python
rat = Enemy(
    name="–ö—Ä—ã—Å–∞",
    stats=CombatStats(
        health=20,
        attack=5,
        defense=2,
        movement=4,
        speed=6
    ),
    ai_type="aggressive"
)
```

#### –ì–æ–±–ª–∏–Ω (–û–±—ã—á–Ω—ã–π –±–ª–∏–∂–Ω–∏–π)
```python
goblin = Enemy(
    name="–ì–æ–±–ª–∏–Ω",
    stats=CombatStats(
        health=40,
        attack=10,
        defense=5,
        movement=3,
        speed=5
    ),
    ai_type="tactical"
)
```

#### –°–∫–µ–ª–µ—Ç-–ª—É—á–Ω–∏–∫ (–î–∞–ª—å–Ω–∏–π)
```python
skeleton_archer = Enemy(
    name="–°–∫–µ–ª–µ—Ç-–ª—É—á–Ω–∏–∫",
    stats=CombatStats(
        health=30,
        attack=12,
        defense=3,
        movement=2,
        speed=4,
        range=5
    ),
    ai_type="ranged"
)
```

#### –ú—É—Ç–∞–Ω—Ç (–°–∏–ª—å–Ω—ã–π –±–ª–∏–∂–Ω–∏–π)
```python
mutant = Enemy(
    name="–ú—É—Ç–∞–Ω—Ç",
    stats=CombatStats(
        health=150,
        attack=25,
        defense=15,
        movement=2,
        speed=3
    ),
    abilities=["regeneration", "poison_attack"],
    ai_type="aggressive"
)
```

---

## 7. AI –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤

### 7.1 –¢–∏–ø—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è

```python
class EnemyAI:
    """AI –≤—Ä–∞–≥–æ–≤"""
    
    def __init__(self, ai_type: str):
        self.ai_type = ai_type
        
    def decide_action(self, enemy: Unit, player: Unit, battlefield) -> Action:
        """–†–µ—à–µ–Ω–∏–µ –æ –¥–µ–π—Å—Ç–≤–∏–∏"""
        
        if self.ai_type == "aggressive":
            return self._aggressive_ai(enemy, player, battlefield)
        elif self.ai_type == "defensive":
            return self._defensive_ai(enemy, player, battlefield)
        elif self.ai_type == "tactical":
            return self._tactical_ai(enemy, player, battlefield)
        elif self.ai_type == "ranged":
            return self._ranged_ai(enemy, player, battlefield)
            
    def _aggressive_ai(self, enemy, player, battlefield) -> Action:
        """–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π AI - –≤—Å–µ–≥–¥–∞ –∏–¥–µ—Ç –≤ –∞—Ç–∞–∫—É"""
        # –î–≤–∏–≥–∞—Ç—å—Å—è –∫ –∏–≥—Ä–æ–∫—É
        # –ê—Ç–∞–∫–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –≤ —Ä–∞–¥–∏—É—Å–µ
        pass
        
    def _tactical_ai(self, enemy, player, battlefield) -> Action:
        """–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π AI - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∫—Ä—ã—Ç–∏—è"""
        # –û—Ü–µ–Ω–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∫—Ä—ã—Ç–∏—è
        # –ê—Ç–∞–∫–æ–≤–∞—Ç—å —Å –≤—ã–≥–æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
        pass
        
    def _ranged_ai(self, enemy, player, battlefield) -> Action:
        """–î–∞–ª—å–Ω–∏–π AI - –¥–µ—Ä–∂–∏—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏—é"""
        # –î–µ—Ä–∂–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
        # –°—Ç—Ä–µ–ª—è—Ç—å
        # –û—Ç—Å—Ç—É–ø–∞—Ç—å, –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –±–ª–∏–∑–∫–æ
        pass
```

---

## 8. –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è

### 8.1 –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–∞

```python
class Ability:
    """–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å"""
    
    def __init__(self, name: str, cost: int, cooldown: int):
        self.name = name
        self.cost = cost  # –°—Ç–æ–∏–º–æ—Å—Ç—å (–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å/–º–∞–Ω–∞)
        self.cooldown = cooldown
        self.current_cooldown = 0
```

#### –ü—Ä–∏–º–µ—Ä—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π:

1. **–ú–æ—â–Ω—ã–π —É–¥–∞—Ä**
   - –£—Ä–æ–Ω x2
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: 20 –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏
   - –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞: 3 —Ö–æ–¥–∞

2. **–†—ã–≤–æ–∫**
   - +3 –∫–ª–µ—Ç–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: 15 –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏
   - –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞: 2 —Ö–æ–¥–∞

3. **–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä**
   - 30 —É—Ä–æ–Ω–∞ –æ–≥–Ω–µ–º (3x3 –æ–±–ª–∞—Å—Ç—å)
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: 25 –º–∞–Ω—ã
   - –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞: 4 —Ö–æ–¥–∞

4. **–õ–µ—á–µ–Ω–∏–µ**
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 40 HP
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: 30 –º–∞–Ω—ã
   - –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞: 5 —Ö–æ–¥–æ–≤

### 8.2 –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä—É–Ω –≤ –±–æ—é

–†—É–Ω—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ **–∞–∫—Ç–∏–≤–Ω—ã** –≤ –±–æ—é, –µ—Å–ª–∏ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω—ã:

```python
class RuneEffect:
    """–≠—Ñ—Ñ–µ–∫—Ç —Ä—É–Ω—ã –≤ –±–æ—é"""
    
    @staticmethod
    def apply_to_combat(player: Player):
        """–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —Ä—É–Ω"""
        
        for rune in player.equipped_runes:
            # –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            if rune.positive_effect["stat"] == "attack":
                player.combat_stats.attack += rune.positive_effect["value"]
                
            # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            if rune.negative_effect["stat"] == "defense":
                player.combat_stats.defense += rune.negative_effect["value"]
```

---

## 9. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–æ—è

### 9.1 –£—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã

```python
class CombatEnd:
    """–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–æ—è"""
    
    @staticmethod
    def check_end_condition(combat: Combat) -> Optional[str]:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"""
        
        # –ü–æ–±–µ–¥–∞ - –≤—Å–µ –≤—Ä–∞–≥–∏ –º–µ—Ä—Ç–≤—ã
        if all(enemy.is_dead() for enemy in combat.enemies):
            return "victory"
            
        # –ü–æ—Ä–∞–∂–µ–Ω–∏–µ - –∏–≥—Ä–æ–∫ –º–µ—Ä—Ç–≤
        if combat.player.is_dead():
            return "defeat"
            
        # –ü–æ–±–µ–≥ - –∏–≥—Ä–æ–∫ —Å–±–µ–∂–∞–ª
        if combat.player_escaped:
            return "escaped"
            
        return None
```

### 9.2 –ù–∞–≥—Ä–∞–¥—ã

```python
class CombatRewards:
    """–ù–∞–≥—Ä–∞–¥—ã –∑–∞ –±–æ–π"""
    
    @staticmethod
    def calculate(enemies: List[Enemy]) -> dict:
        """–†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥"""
        
        total_exp = sum(enemy.exp_reward for enemy in enemies)
        total_gold = sum(enemy.gold_reward for enemy in enemies)
        
        # –®–∞–Ω—Å –¥—Ä–æ–ø–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        items = []
        for enemy in enemies:
            if random.random() < enemy.drop_chance:
                items.append(enemy.drop_item())
                
        return {
            "exp": total_exp,
            "gold": total_gold,
            "items": items
        }
```

### 9.3 –í–æ–∑–≤—Ä–∞—Ç –∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é

```
–ü–æ–±–µ–¥–∞ ‚Üí –≠–∫—Ä–∞–Ω –Ω–∞–≥—Ä–∞–¥ (2 —Å–µ–∫) ‚Üí –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å
                                              (–≤—Ä–∞–≥ –∏—Å—á–µ–∑–∞–µ—Ç)
```

---

## 10. UI –±–æ–µ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞

### 10.1 –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [–ü–∞—É–∑–∞] [–ù–∞—Å—Ç—Ä–æ–π–∫–∏]           –•–û–î: –ò–≥—Ä–æ–∫   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                             ‚îÇ
‚îÇ         –ë–û–ï–í–û–ï –ü–û–õ–ï (—Å–º. –≤—ã—à–µ)              ‚îÇ
‚îÇ                                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üë§ –ò–ì–†–û–ö                                   ‚îÇ
‚îÇ  ‚ù§Ô∏è 85/100  ‚ö° 50/100  üîÆ 30/50            ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  [‚öîÔ∏è –ê—Ç–∞–∫–∞] [üõ°Ô∏è –ó–∞—â–∏—Ç–∞] [‚ú® –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å]   ‚îÇ
‚îÇ  [üéí –ü—Ä–µ–¥–º–µ—Ç] [‚è≠Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ] [üèÉ –ü–æ–±–µ–≥]     ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –¶–ï–õ–¨: üëπ –ú—É—Ç–∞–Ω—Ç                            ‚îÇ
‚îÇ  ‚ù§Ô∏è 120/150  üõ°Ô∏è –ó–∞—â–∏—Ç–∞: 15                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 10.2 –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

- **–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–ª–µ—Ç–æ–∫:**
  - üü¢ –ó–µ–ª–µ–Ω—ã–π - –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
  - üî¥ –ö—Ä–∞—Å–Ω—ã–π - –≤—Ä–∞–≥ –≤ —Ä–∞–¥–∏—É—Å–µ –∞—Ç–∞–∫–∏
  - üîµ –°–∏–Ω–∏–π - –≤—ã–±—Ä–∞–Ω–Ω—ã–π —é–Ω–∏—Ç
  - üü° –ñ–µ–ª—Ç—ã–π - –æ–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

- **–ü–æ–ª–æ—Å–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è:**
  - –ù–∞–¥ –∫–∞–∂–¥—ã–º —é–Ω–∏—Ç–æ–º
  - –¶–≤–µ—Ç: –∑–µ–ª–µ–Ω—ã–π ‚Üí –∂–µ–ª—Ç—ã–π ‚Üí –∫—Ä–∞—Å–Ω—ã–π

- **–û—á–µ—Ä–µ–¥—å —Ö–æ–¥–æ–≤:**
  - –°–ø—Ä–∞–≤–∞ –æ—Ç –ø–æ–ª—è
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ 5 —Ö–æ–¥–æ–≤

---

## 11. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 11.1 –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

```python
class GameMode(Enum):
    """–†–µ–∂–∏–º—ã –∏–≥—Ä—ã"""
    EXPLORATION = "exploration"  # –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
    COMBAT = "combat"           # –ë–æ–π
    MENU = "menu"               # –ú–µ–Ω—é
    
class Game:
    def __init__(self):
        self.mode = GameMode.EXPLORATION
        self.combat: Optional[Combat] = None
        
    def switch_to_combat(self, enemies: List[Enemy]):
        """–ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –±–æ—è"""
        self.mode = GameMode.COMBAT
        self.combat = Combat(self.player, enemies)
        
    def switch_to_exploration(self):
        """–í–æ–∑–≤—Ä–∞—Ç –∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é"""
        self.mode = GameMode.EXPLORATION
        self.combat = None
```

### 11.2 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è

```python
@dataclass
class CombatSaveData:
    """–î–∞–Ω–Ω—ã–µ –±–æ—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"""
    battlefield: np.ndarray
    player_position: tuple[int, int]
    enemies: List[dict]
    turn_order: List[str]
    current_turn: int
    
    # –ù–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –±–æ—è!
    # –ù–æ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
```

---

## 12. –ë–∞–ª–∞–Ω—Å

### 12.1 –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ —ç—Ç–∞–∂–∞–º

| –≠—Ç–∞–∂–∏ | –í—Ä–∞–≥–∏ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-------|-------|-----------|-----------|
| 1-3   | –ö—Ä—ã—Å—ã, —Å–ª–∏–∑–∏ | 1-2 | –õ–µ–≥–∫–æ |
| 4-7   | –ì–æ–±–ª–∏–Ω—ã, —Å–∫–µ–ª–µ—Ç—ã | 2-3 | –°—Ä–µ–¥–Ω–µ |
| 8-12  | –û—Ä–∫–∏, –º—É—Ç–∞–Ω—Ç—ã | 2-4 | –°–ª–æ–∂–Ω–æ |
| 13-17 | –ì–æ–ª–µ–º—ã, –º–∞–≥–∏ | 3-5 | –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ |
| 18-20 | –≠–ª–∏—Ç—ã, –±–æ—Å—Å—ã | 4-6 | –≠–∫—Å—Ç—Ä–∏–º |

### 12.2 –ù–∞–≥—Ä–∞–¥—ã

- **–û–ø—ã—Ç:** 10-50 –∑–∞ –≤—Ä–∞–≥–∞
- **–ó–æ–ª–æ—Ç–æ:** 5-100 –∑–∞ –≤—Ä–∞–≥–∞
- **–ü—Ä–µ–¥–º–µ—Ç—ã:** 10-30% —à–∞–Ω—Å –¥—Ä–æ–ø–∞

---

–ü–æ—à–∞–≥–æ–≤–∞—è –±–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ —Å—Ç–∏–ª–µ HoMM –≥–æ—Ç–æ–≤–∞! ‚öîÔ∏èüéÆ
